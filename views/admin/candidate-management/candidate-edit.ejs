<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= pageTitle %> • Scout Express</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/admin.css">
  <link rel="stylesheet" href="/css/candidate-management.css">
</head>
<body>
  <%- include('../admin-header') %>
  
  <div class="admin-layout">
    <%- include('../admin-sidebar', { activePage: 'candidates' }) %>
    
    <main class="admin-main">
      <div class="admin-content">
        <div class="content-header">
          <h1>Edit Candidate</h1>
          <div class="header-actions">
            <a href="/admin/candidates/<%= candidate.id %>" class="btn btn-secondary">← Back to View</a>
            <a href="/admin/candidates" class="btn btn-secondary">← Back to List</a>
          </div>
        </div>

        <!-- Edit Form -->
        <div class="edit-form-container">
          <form method="POST" action="/admin/candidates/<%= candidate.id %>/update" class="candidate-edit-form">
            
            <!-- Basic Information -->
            <div class="form-section">
              <h3>Basic Information</h3>
                  <div class="form-grid">
                <div class="form-group">
                  <label for="full_name">Full Name *</label>
                  <input type="text" id="full_name" name="full_name" value="<%= candidate.full_name %>" required>
                </div>
                <div class="form-group">
                  <label for="email">Email *</label>
                  <input type="email" id="email" name="email" value="<%= candidate.email %>" required>
                </div>
                <div class="form-group">
                  <label for="phone_number">Phone Number *</label>
                  <input type="tel" id="phone_number" name="phone_number" value="<%= candidate.phone_number %>" required>
                </div>
                <div class="form-group">
                  <label for="professional_headline">Professional Headline</label>
                  <input type="text" id="professional_headline" name="professional_headline" value="<%= candidate.professional_headline || '' %>">
                </div>
              </div>
              <div class="form-group full-width">
                <label for="professional_summary">Professional Summary</label>
                <textarea id="professional_summary" name="professional_summary" rows="4"><%= candidate.professional_summary || '' %></textarea>
              </div>
            </div>

            <!-- Location Information -->
            <div class="form-section">
              <h3>Location Information</h3>
              <div class="form-grid">
                <div class="form-group">
                  <label for="city">City</label>
                  <input type="text" id="city" name="city" value="<%= candidate.city || '' %>">
                </div>
                <div class="form-group">
                  <label for="district">District</label>
                  <input type="text" id="district" name="district" value="<%= candidate.district || '' %>">
                </div>
                <div class="form-group">
                  <label for="state">State</label>
                  <input type="text" id="state" name="state" value="<%= candidate.state || '' %>">
                </div>
                <div class="form-group">
                  <label for="country">Country</label>
                  <input type="text" id="country" name="country" value="<%= candidate.country || '' %>">
                </div>
                <div class="form-group">
                  <label for="pin_code">PIN Code</label>
                  <input type="text" id="pin_code" name="pin_code" value="<%= candidate.pin_code || '' %>">
                </div>
              </div>
            </div>

            <!-- Work Experience -->
            <div class="form-section">
              <h3>Work Experience</h3>
              <div id="work-experience-container">
                <% if (candidate.work_experience && candidate.work_experience.length > 0) { %>
                  <% candidate.work_experience.forEach((work, index) => { %>
                    <div class="work-experience-item" data-index="<%= index %>">
                      <div class="form-grid">
                        <div class="form-group">
                          <label>Company *</label>
                          <input type="text" name="experience[<%= index %>][company_name]" value="<%= work.company %>" required>
                        </div>
                        <div class="form-group">
                          <label>Position *</label>
                          <input type="text" name="experience[<%= index %>][job_title]" value="<%= work.position %>" required>
                        </div>
                        <div class="form-group">
                          <label>Start Date</label>
                          <input type="date" name="experience[<%= index %>][job_start_date]" value="<%= work.start_date || '' %>">
                        </div>
                        <div class="form-group">
                          <label>End Date</label>
                          <input type="date" name="experience[<%= index %>][job_end_date]" value="<%= work.end_date || '' %>">
                        </div>
                        <div class="form-group">
                          <label>
                            <input type="checkbox" name="experience[<%= index %>][currently_work]" <%= work.currently_working === 'on' ? 'checked' : '' %>>
                            Currently Working
                          </label>
                        </div>
                        <div class="form-group full-width">
                          <label>Description</label>
                          <textarea name="experience[<%= index %>][job_description]" rows="3"><%= work.description || '' %></textarea>
                        </div>
                      </div>
                      <button type="button" onclick="removeItem(this)" class="btn btn-danger btn-sm">Remove</button>
                    </div>
                  <% }); %>
                <% } %>
              </div>
              <button type="button" onclick="addWorkExperience()" class="btn btn-secondary">Add Work Experience</button>
            </div>

            <!-- Education -->
            <div class="form-section">
              <h3>Education</h3>
              <div id="education-container">
                <% if (candidate.education && candidate.education.length > 0) { %>
                  <% candidate.education.forEach((edu, index) => { %>
                    <div class="education-item" data-index="<%= index %>">
                      <div class="form-grid">
                        <div class="form-group">
                          <label>Degree *</label>
                          <input type="text" name="education[<%= index %>][degree]" value="<%= edu.degree %>" required>
                        </div>
                        <div class="form-group">
                          <label>Institution *</label>
                          <input type="text" name="education[<%= index %>][institution_name]" value="<%= edu.institution %>" required>
                        </div>
                        <div class="form-group">
                          <label>Graduation Year</label>
                          <input type="number" name="education[<%= index %>][graduation_year]" value="<%= edu.graduation_year || '' %>" min="1900" max="2100">
                        </div>
                        <div class="form-group">
                          <label>Grade</label>
                          <input type="text" name="education[<%= index %>][grade]" value="<%= edu.grade || '' %>">
                        </div>
                      </div>
                      <button type="button" onclick="removeItem(this)" class="btn btn-danger btn-sm">Remove</button>
                    </div>
                  <% }); %>
                <% } %>
              </div>
              <button type="button" onclick="addEducation()" class="btn btn-secondary">Add Education</button>
            </div>

            <!-- Skills -->
            <div class="form-section">
              <h3>Skills</h3>
              <div id="skills-container">
                <% if (candidate.skills && candidate.skills.length > 0) { %>
                  <% candidate.skills.forEach((skill, index) => { %>
                    <div class="skill-item" data-index="<%= index %>">
                      <div class="form-grid">
                        <div class="form-group">
                          <label>Skill Name *</label>
                          <input type="text" name="skills[<%= index %>][skill_name]" value="<%= skill.skill_name %>" required>
                        </div>
                      </div>
                      <button type="button" onclick="removeItem(this)" class="btn btn-danger btn-sm">Remove</button>
                    </div>
                  <% }); %>
                <% } %>
              </div>
              <button type="button" onclick="addSkill()" class="btn btn-secondary">Add Skill</button>
            </div>

            <!-- Job Preferences -->
            <div class="form-section">
              <h3>Job Preferences</h3>
              <div class="form-grid">
                <div class="form-group">
                  <label for="expected_salary">Expected Salary</label>
                  <input type="text" id="expected_salary" name="preferences[expected_salary]" value="<%= candidate.job_preferences && candidate.job_preferences.expected_salary || '' %>">
                </div>
                <div class="form-group">
                  <label for="availability">Availability</label>
                  <select id="availability" name="preferences[availability]">
                  <option value="">Select availability</option>
                  <option value="immediately" <%= (candidate.job_preferences && candidate.job_preferences.availability === 'immediately') ? 'selected' : '' %>>Immediately</option>
                  <option value="within_1_month" <%= (candidate.job_preferences && candidate.job_preferences.availability === 'within_1_month') ? 'selected' : '' %>>Within 1 month</option>
                  <option value="within_3_months" <%= (candidate.job_preferences && candidate.job_preferences.availability === 'within_3_months') ? 'selected' : '' %>>Within 3 months</option>
                  <option value="within_6_months" <%= (candidate.job_preferences && candidate.job_preferences.availability === 'within_6_months') ? 'selected' : '' %>>Within 6 months</option>
                  <option value="not_available" <%= (candidate.job_preferences && candidate.job_preferences.availability === 'not_available') ? 'selected' : '' %>>Not available</option>
                </select>
                </div>
              </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
              <button type="submit" class="btn btn-primary">Save Changes</button>
              <a href="/admin/candidates/<%= candidate.id %>" class="btn btn-secondary">Cancel</a>
            </div>
          </form>
        </div>
      </div>
    </main>
  </div>

  <%- include('../admin-footer') %>

  <script>
    let workExperienceIndex = <%= candidate.work_experience ? candidate.work_experience.length : 0 %>;
    let educationIndex = <%= candidate.education ? candidate.education.length : 0 %>;
    let skillIndex = <%= candidate.skills ? candidate.skills.length : 0 %>;

    function addWorkExperience() {
      const container = document.getElementById('work-experience-container');
      const item = document.createElement('div');
      item.className = 'work-experience-item';
      item.dataset.index = workExperienceIndex;
      
      item.innerHTML = `
        <div class="form-grid">
          <div class="form-group">
            <label>Company *</label>
            <input type="text" name="experience[${workExperienceIndex}][company_name]" required>
          </div>
          <div class="form-group">
            <label>Position *</label>
            <input type="text" name="experience[${workExperienceIndex}][job_title]" required>
          </div>
          <div class="form-group">
            <label>Start Date</label>
            <input type="date" name="experience[${workExperienceIndex}][job_start_date]">
          </div>
          <div class="form-group">
            <label>End Date</label>
            <input type="date" name="experience[${workExperienceIndex}][job_end_date]">
          </div>
          <div class="form-group">
            <label>
              <input type="checkbox" name="experience[${workExperienceIndex}][currently_work]">
              Currently Working
            </label>
          </div>
          <div class="form-group full-width">
            <label>Description</label>
            <textarea name="experience[${workExperienceIndex}][job_description]" rows="3"></textarea>
          </div>
        </div>
        <button type="button" onclick="removeItem(this)" class="btn btn-danger btn-sm">Remove</button>
      `;
      
      container.appendChild(item);
      workExperienceIndex++;
    }

    function addEducation() {
      const container = document.getElementById('education-container');
      const item = document.createElement('div');
      item.className = 'education-item';
      item.dataset.index = educationIndex;
      
      item.innerHTML = `
        <div class="form-grid">
          <div class="form-group">
            <label>Degree *</label>
            <input type="text" name="education[${educationIndex}][degree]" required>
          </div>
          <div class="form-group">
            <label>Institution *</label>
            <input type="text" name="education[${educationIndex}][institution_name]" required>
          </div>
          <div class="form-group">
            <label>Graduation Year</label>
            <input type="number" name="education[${educationIndex}][graduation_year]" min="1900" max="2100">
          </div>
          <div class="form-group">
            <label>Grade</label>
            <input type="text" name="education[${educationIndex}][grade]">
          </div>
        </div>
        <button type="button" onclick="removeItem(this)" class="btn btn-danger btn-sm">Remove</button>
      `;
      
      container.appendChild(item);
      educationIndex++;
    }

    function addSkill() {
      const container = document.getElementById('skills-container');
      const item = document.createElement('div');
      item.className = 'skill-item';
      item.dataset.index = skillIndex;
      
      item.innerHTML = `
        <div class="form-grid">
          <div class="form-group">
            <label>Skill Name *</label>
            <input type="text" name="skills[${skillIndex}][skill_name]" required>
          </div>
        </div>
        <button type="button" onclick="removeItem(this)" class="btn btn-danger btn-sm">Remove</button>
      `;
      
      container.appendChild(item);
      skillIndex++;
    }

    function removeItem(button) {
      button.parentElement.remove();
    }
  </script>
</body>
</html>
